# kodomi TANK 表示問題 デバッグチェックリスト

## 影響を受けるユーザーのブラウザで以下を確認してください：

### 1. コンソールログ確認
ブラウザの開発者ツール（F12）→ Consoleタブを開いて以下のログを確認：

```
🚀🚀🚀 [KODOMI-DEBUG-v2] useDualAxisKodomi - フック呼び出し
  address: 0x... または null/undefined
```

**チェック項目：**
- ✅ `address`が正しいウォレットアドレスになっているか？
- ❌ `address`が`null`または`undefined`のままになっていないか？

### 2. Supabaseクエリ結果確認
```
📊 [KODOMI-DEBUG-v2] Supabaseクエリ完了
  エラー: null または エラーメッセージ
  取得したトランザクション数: X件
```

**チェック項目：**
- ✅ トランザクション数が0件以上あるか？
- ❌ エラーが発生していないか？
- ❌ トランザクション数が0件なのに、実際にはチップを送信しているか？

### 3. データ集計結果確認
```
✅✅✅ [KODOMI-DEBUG-v2] データセット完了:
  JPYC総額: X JPYC
  JPYCチップ回数: X
  NHTチップ回数: X
```

**チェック項目：**
- ✅ JPYC総額が実際の送信額と一致しているか？
- ✅ チップ回数が正しいか？

### 4. TANK表示確認
```
🎯🎯🎯 [TANK-DEBUG-v2] OverallKodomiTank - コンポーネントレンダリング
[TANK-DEBUG-v2] フック結果:
  loading: false
  JPYC総額: X JPYC
```

**チェック項目：**
- ✅ `loading`が`false`になっているか？
- ❌ ずっと`loading: true`のままになっていないか？

---

## 問題パターン別の原因

### パターンA: addressがnullのまま
**原因:** ウォレットが接続されていない、または`useAddress()`が正常に動作していない

**確認方法:**
1. ウォレット接続状態を確認
2. 他のページでもウォレットアドレスが表示されているか確認
3. ページリロード後も同じか確認

### パターンB: トランザクション数が0件
**原因:** Supabaseの`transfer_messages`テーブルに該当データがない、またはアドレスの大文字小文字が一致していない

**確認方法:**
1. Supabaseで直接クエリを実行
   ```sql
   SELECT * FROM transfer_messages
   WHERE LOWER(from_address) = LOWER('ユーザーのアドレス');
   ```
2. データが存在するか確認
3. `from_address`の値とウォレットアドレスが完全一致しているか確認

### パターンC: データはあるが表示されない
**原因:** Reactの状態更新が正常に行われていない、またはコンポーネントの再レンダリングが発生していない

**確認方法:**
1. `setData`が実行されているか確認（コンソールログに`[KODOMI-DEBUG-v2] setData実行完了`が出ているか）
2. TANKコンポーネントが再レンダリングされているか確認

---

## 即座に試せる修正案

### 修正1: addressのnullチェックを厳密化
問題のあるユーザーで`address`が`undefined`のまま固定されている可能性があります。

### 修正2: データ取得のリトライ機構追加
初回失敗時に自動リトライする仕組みを追加。

### 修正3: ローカルストレージキャッシュのクリア
古いキャッシュが干渉している可能性を排除。
