# äºŒè»¸ã‚¹ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ  ğŸ“Š

## æ¦‚è¦

Gifterraã®äºŒè»¸ã‚¹ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è²¢çŒ®ã‚’2ã¤ã®ç‹¬ç«‹ã—ãŸè»¸ã§è©•ä¾¡ã™ã‚‹ã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¢ãƒ‡ãƒ«

**âš ï¸ ã‚°ãƒ­ãƒ¼ãƒãƒ«å˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è¨­è¨ˆ**

- ScoreRegistryã¯**ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã§1ã¤ã®ã¿**ãƒ‡ãƒ—ãƒ­ã‚¤
- å…¨ãƒ†ãƒŠãƒ³ãƒˆå…±é€šã®ã‚¹ã‚³ã‚¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ãƒˆãƒ¼ã‚¯ãƒ³è»¸ã‚’ç®¡ç†
- ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ãŒä¸€å…ƒç®¡ç†

**è¨­è¨ˆç†ç”±:**
- **å…¬å¹³æ€§**: è¤‡æ•°ãƒ†ãƒŠãƒ³ãƒˆã‚’å¿œæ´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸€è²«ã—ãŸè©•ä¾¡åŸºæº–ã§è²¢çŒ®åº¦ã‚’æ¸¬å®šã§ãã‚‹
- **æ³•å‹™ãƒªã‚¹ã‚¯ç®¡ç†**: ãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ ã‚’ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ãŒä¸€å…ƒç®¡ç†ã—ã€è³‡é‡‘æ±ºæ¸ˆæ³•ç­‰ã®ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’æ‹…ä¿
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“**: ã€ŒGifterraã§ã®ç·åˆè²¢çŒ®åº¦ã€ã¨ã„ã†çµ±ä¸€ã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼

### è»¸ã®å®šç¾©

- **ğŸ’¸ Economicè»¸ï¼ˆçµŒæ¸ˆè²¢çŒ®ï¼‰**: JPYCç­‰ã®æ³•å®šä¾¡å€¤ç³»ãƒˆãƒ¼ã‚¯ãƒ³ã§ã®é‡‘éŠ­çš„è²¢çŒ®
- **ğŸ”¥ Resonanceè»¸ï¼ˆå…±é³´ç†±é‡ï¼‰**: NHTç­‰ã®å¿œæ´ç³»ãƒˆãƒ¼ã‚¯ãƒ³ã‚„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å›æ•°ã§ã®ç¶™ç¶šçš„ç†±é‡
- **ğŸ“Š Compositeè»¸ï¼ˆåˆæˆã‚¹ã‚³ã‚¢ï¼‰**: ä¸Šè¨˜2è»¸ã‚’åŠ é‡åˆæˆã—ãŸç·åˆè©•ä¾¡

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Blockchain Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ScoreRegistry    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ GifterraPaySplitterV2 â”‚    â”‚
â”‚  â”‚ (Parameter Mgmt) â”‚         â”‚ (Hook Integration)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â”‚ emit ScoreIncremented                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Indexer Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Event Listener   â”‚â”€â”€â”€â–ºâ”‚ Score Database       â”‚          â”‚
â”‚  â”‚ (ethers.js)      â”‚    â”‚ (Supabase)           â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                      â”‚                       â”‚
â”‚                                      â–¼                       â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                          â”‚ Score Calculator      â”‚          â”‚
â”‚                          â”‚ (Pure Functions)      â”‚          â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Layer                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ REST API (Express)                                    â”‚  â”‚
â”‚  â”‚  - GET /api/profile/:userId                          â”‚  â”‚
â”‚  â”‚  - GET /api/rankings/:axis                           â”‚  â”‚
â”‚  â”‚  - POST /api/admin/params                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     UI Layer (Next Steps)                    â”‚
â”‚  - Dual-axis tank visualization                             â”‚
â”‚  - Three-tab ranking panel                                  â”‚
â”‚  - AI assistant "Gifty"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. Supabaseè¨­å®š

Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ:

```bash
# Supabase CLIã®å ´åˆ
supabase migration up

# ã¾ãŸã¯ã€Supabase Studioã§ç›´æ¥å®Ÿè¡Œ
# supabase/migrations/20250128_score_system.sql ã‚’ã‚³ãƒ”ãƒš
```

### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```bash
# Blockchain
RPC_URL=https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY
SCORE_REGISTRY_ADDRESS=0x... # ã‚°ãƒ­ãƒ¼ãƒãƒ«ScoreRegistryï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã§å…±æœ‰ï¼‰
START_BLOCK=12345678 # ã‚¹ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹ãƒ–ãƒ­ãƒƒã‚¯

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# API
API_PORT=3001
ADMIN_API_KEY=your-secret-admin-key

# Indexer
ENABLE_BACKFILL=true # åˆå›èµ·å‹•æ™‚ã®ã¿true
BACKFILL_CHUNK_SIZE=10000
ENABLE_DAILY_SNAPSHOT=true
SNAPSHOT_CRON=00:00 # UTC
```

### 3. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ScoreRegistryã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
pnpm hardhat run scripts/deploy-score-registry.ts --network polygon

# GifterraPaySplitterV2ã«ScoreRegistryã‚’è¨­å®š
pnpm hardhat run scripts/set-score-registry.ts --network polygon

# ãƒˆãƒ¼ã‚¯ãƒ³è»¸ã‚’è¨­å®š
pnpm hardhat run scripts/configure-token-axes.ts --network polygon
```

### 4. ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µèµ·å‹•

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# TypeScriptãƒ“ãƒ«ãƒ‰
pnpm build

# ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µèµ·å‹•
pnpm start:indexer

# ã¾ãŸã¯é–‹ç™ºãƒ¢ãƒ¼ãƒ‰
pnpm dev:indexer
```

## ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆä»•æ§˜

### ScoreRegistry.sol

#### ä¸»è¦æ©Ÿèƒ½

```solidity
// ãƒˆãƒ¼ã‚¯ãƒ³è»¸ã‚’è¨­å®š
function setTokenAxis(address token, bool isEconomic) external onlyRole(ADMIN_ROLE)

// ã‚¹ã‚³ã‚¢ã‚’è¨˜éŒ²ï¼ˆä»–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰å‘¼ã³å‡ºã—ï¼‰
function recordScore(
  address user,
  address token,
  uint256 amountRaw,
  bytes32 traceId
) external

// ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°
function updateScoreParams(
  uint256 weightEconomic,
  uint256 weightResonance,
  Curve curve
) external onlyRole(ADMIN_ROLE)
```

#### ã‚¤ãƒ™ãƒ³ãƒˆ

```solidity
event ScoreIncremented(
  address indexed user,
  address indexed token,
  uint256 amountRaw,
  bytes32 axis,
  bytes32 indexed traceId
);

event ScoreParamsUpdated(
  uint256 weightEconomic,
  uint256 weightResonance,
  Curve curve,
  uint256 timestamp
);

event TokenAxisUpdated(
  address indexed token,
  bool isEconomic,
  uint256 timestamp
);
```

## APIä»•æ§˜

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«

```bash
GET /api/profile/:userId
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "data": {
    "userId": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
    "address": "0x742d35cc6634c0532925a3b844bc9e7595f0beb",
    "economic": {
      "score": 1500000,
      "level": 45,
      "displayLevel": 45,
      "tokens": {
        "0x6ae...": "1000000000000000000000"
      }
    },
    "resonance": {
      "score": 250,
      "level": 25,
      "displayLevel": 25,
      "count": 230,
      "streak": 14,
      "longestStreak": 30,
      "lastDate": "2025-01-28T12:00:00Z",
      "actions": {
        "tips": 230,
        "purchases": 0,
        "claims": 0,
        "logins": 0
      }
    },
    "composite": {
      "score": 2250,
      "economicWeight": 100,
      "resonanceWeight": 100,
      "curve": "Sqrt",
      "formula": "100 * economic + 100 * sqrt(resonance)"
    },
    "lastUpdated": "2025-01-28T12:00:00Z"
  }
}
```

### ãƒ©ãƒ³ã‚­ãƒ³ã‚°å–å¾—

```bash
GET /api/rankings/:axis?limit=100&offset=0
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `axis`: `economic` | `resonance` | `composite`
- `limit`: å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ï¼‰
- `offset`: ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "data": {
    "axis": "COMPOSITE",
    "rankings": [
      {
        "rank": 1,
        "userId": "...",
        "address": "0x...",
        "displayName": "Alice",
        "avatar": "https://...",
        "economicScore": 5000000,
        "resonanceScore": 1000,
        "compositeScore": 8000,
        "economicLevel": 70,
        "resonanceLevel": 50,
        "badge": "ğŸ†",
        "title": "Legend"
      }
    ],
    "pagination": {
      "limit": 100,
      "offset": 0,
      "total": 1250,
      "hasMore": true
    }
  }
}
```

### Adminæ“ä½œ

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°

```bash
POST /api/admin/params
Headers: x-api-key: YOUR_ADMIN_API_KEY
Content-Type: application/json

{
  "weightEconomic": 150,
  "weightResonance": 80,
  "curve": "Sqrt"
}
```

#### ãƒˆãƒ¼ã‚¯ãƒ³è»¸è¨­å®š

```bash
POST /api/admin/token-axis
Headers: x-api-key: YOUR_ADMIN_API_KEY
Content-Type: application/json

{
  "token": "0x6ae...",
  "isEconomic": true
}
```

## ã‚¹ã‚³ã‚¢è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

### Economicè»¸

```typescript
// 1. ãƒˆãƒ¼ã‚¯ãƒ³åˆ¥ã«ç´¯ç©
economicScore.tokens[token] += amountRaw

// 2. JPYCæ›ç®—ã«æ­£è¦åŒ–
normalized = sum(token amounts in JPYC)

// 3. ãƒ¬ãƒ™ãƒ«è¨ˆç®—ï¼ˆå¹³æ–¹æ ¹ãƒ™ãƒ¼ã‚¹ï¼‰
level = min(100, floor(sqrt(jpycAmount) * 0.0001 * 100))
```

### Resonanceè»¸ï¼ˆè²¢çŒ®ç†±é‡åº¦ - kodomiï¼‰

```typescript
// ã€æ¡ˆA: å›æ•°ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆã€‘
// å…¨ãƒˆãƒ¼ã‚¯ãƒ³ç¨®åˆ¥ã‚’åŒã˜é‡ã¿ï¼ˆ1.0ï¼‰ã§è©•ä¾¡

// 1. ãƒˆãƒ¼ã‚¯ãƒ³ç¨®åˆ¥ã”ã¨ã®å›æ•°ã‚’ç´¯ç©
utilityTokenTips += 1  // tNHTç­‰ã§ã®TIP
economicTokenTips += 1 // JPYCç­‰ã§ã®TIP

// 2. é€£ç¶šæ—¥æ•°ãƒœãƒ¼ãƒŠã‚¹
if (ä»Šæ—¥ === æ˜¨æ—¥ + 1æ—¥) {
  streak += 1
} else {
  streak = 1
}

// 3. ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢ = å…¨å›æ•°ã®åˆè¨ˆ + é€£ç¶šãƒœãƒ¼ãƒŠã‚¹
baseScore = utilityTokenTips + economicTokenTips
bonus = floor(streak / 7) * 0.1
normalized = baseScore * (1 + bonus)

// 4. ãƒ¬ãƒ™ãƒ«è¨ˆç®—ï¼ˆç·šå½¢ï¼‰
level = min(100, floor(normalized * 1.0))
```

**âš ï¸ æ³•å‹™ãƒªã‚¹ã‚¯å›é¿ã®è¨­è¨ˆï¼ˆæ¡ˆAï¼‰**
- JPYCã¯Economicè»¸ã§ã€Œé‡‘é¡ã€ã¨ã—ã¦è©•ä¾¡
- Resonanceè»¸ï¼ˆkodomiï¼‰ã§ã¯ã€Œå›æ•°ã€ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆï¼ˆå…¨ãƒˆãƒ¼ã‚¯ãƒ³åŒã˜é‡ã¿ï¼‰
- é‡‘é¡ã¨å›æ•°ã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€tNHTã«è³‡ç”£ä¾¡å€¤ãŒã‚ã‚‹ã¨è¦‹ãªã•ã‚Œã‚‹ãƒªã‚¹ã‚¯ã‚’å›é¿
- ã‚·ãƒ³ãƒ—ãƒ«ãªå›æ•°ãƒ™ãƒ¼ã‚¹ã§å…¬å¹³æ€§ã‚’æ‹…ä¿

### Compositeè»¸

```typescript
// 1. Resonanceã«æ›²ç·šã‚’é©ç”¨
rAdjusted = applyCurve(resonance.normalized, params.curve)

// 2. åŠ é‡åˆæˆ
composite =
  (economic.normalized * params.weightEconomic / 100) +
  (rAdjusted * params.weightResonance / 100)
```

æ›²ç·šã®ç¨®é¡:
- **Linear**: `f(x) = x` ï¼ˆç·šå½¢ï¼‰
- **Sqrt**: `f(x) = âˆšx` ï¼ˆå¹³æ–¹æ ¹ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **Log**: `f(x) = logâ‚â‚€(x + 1)` ï¼ˆå¯¾æ•°ï¼‰

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

### 1. ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. ScoreRegistryã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
pnpm hardhat run scripts/deploy-score-registry.ts --network mumbai

# 2. ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’.envã«è¨­å®š
SCORE_REGISTRY_ADDRESS=0x...

# 3. GifterraPaySplitterV2ã«è¨­å®š
pnpm hardhat run scripts/set-score-registry.ts --network mumbai

# 4. ãƒˆãƒ¼ã‚¯ãƒ³è»¸ã‚’è¨­å®š
pnpm hardhat run scripts/configure-token-axes.ts --network mumbai

# 5. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
pnpm hardhat run scripts/test-score-system.ts --network mumbai
```

### 2. ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
docker build -t gifterra-indexer -f Dockerfile.indexer .

# 2. ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker run -d \
  --name gifterra-indexer \
  --env-file .env \
  -p 3001:3001 \
  gifterra-indexer

# 3. ãƒ­ã‚°ç¢ºèª
docker logs -f gifterra-indexer
```

### 3. ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# âš ï¸ æœ¬ç•ªç’°å¢ƒã¯æ…é‡ã«ï¼

# 1. ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã«ãƒ‡ãƒ—ãƒ­ã‚¤
pnpm hardhat run scripts/deploy-score-registry.ts --network polygon

# 2. åˆæœŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®š
pnpm hardhat run scripts/initialize-mainnet.ts --network polygon

# 3. ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µã‚’æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•
NODE_ENV=production pnpm start:indexer
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µãŒèµ·å‹•ã—ãªã„

```bash
# 1. ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
echo $SCORE_REGISTRY_ADDRESS
echo $SUPABASE_URL

# 2. RPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆ
curl $RPC_URL -X POST -H "Content-Type: application/json" \
  --data '{"jsonrpc":"2.0","method":"eth_blockNumber","params":[],"id":1}'

# 3. Supabaseæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆ
psql $DATABASE_URL -c "SELECT * FROM user_scores LIMIT 1;"
```

### ã‚¤ãƒ™ãƒ³ãƒˆãŒå‡¦ç†ã•ã‚Œãªã„

```bash
# 1. ãƒ–ãƒ­ãƒƒã‚¯ç¯„å›²ã‚’ç¢ºèª
# Polygonscanã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèª

# 2. ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«ã‚’å†å®Ÿè¡Œ
ENABLE_BACKFILL=true START_BLOCK=12345678 pnpm start:indexer

# 3. ãƒ­ã‚°ã‚’è©³ç´°ãƒ¢ãƒ¼ãƒ‰ã§ç¢ºèª
LOG_LEVEL=debug pnpm start:indexer
```

### ã‚¹ã‚³ã‚¢ãŒåˆã‚ãªã„

```bash
# 1. ãƒˆãƒ¼ã‚¯ãƒ³è»¸è¨­å®šã‚’ç¢ºèª
curl http://localhost:3001/api/admin/params \
  -H "x-api-key: $ADMIN_API_KEY"

# 2. æ‰‹å‹•ã§ã‚¹ã‚³ã‚¢ã‚’å†è¨ˆç®—
pnpm hardhat run scripts/recalculate-scores.ts

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèª
SELECT * FROM score_transactions WHERE user_address = '0x...' ORDER BY timestamp DESC;
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µ

- **ãƒãƒƒã‚¯ãƒ•ã‚£ãƒ«ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ10,000ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆRPCãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«å¿œã˜ã¦èª¿æ•´ï¼‰
- **ä¸¦è¡Œå‡¦ç†**: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯é †æ¬¡å‡¦ç†ï¼ˆãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ãŸã‚ï¼‰
- **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: Supabaseã®ã‚¯ã‚¨ãƒªçµæœã‚’Redisã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆTODOï¼‰

### API

- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯æœ€å¤§1000ä»¶ã¾ã§
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®**: gzipæœ‰åŠ¹åŒ–æ¨å¥¨
- **CDN**: é™çš„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯Cloudflare CDNçµŒç”±ã§é…ä¿¡ï¼ˆTODOï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: å…¨ä¸»è¦ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆæ¸ˆã¿
- **ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã¯æœˆæ¬¡ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ï¼ˆTODOï¼‰
- **ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–**: 90æ—¥ä»¥ä¸Šå‰ã®ãƒ­ã‚°ã¯åˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç§»å‹•ï¼ˆTODOï¼‰

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### Phase 3: UIå®Ÿè£…

- [ ] äºŒè»¸ã‚¿ãƒ³ã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] ä¸‰ã¤è‘‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‘ãƒãƒ«
- [ ] ãƒ†ãƒŠãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ with ã‚¹ã‚³ã‚¢è¡¨ç¤º
- [ ] ãƒãƒƒã‚¸ãƒ»å®Ÿç¸¾ã‚·ã‚¹ãƒ†ãƒ 

### Phase 4: AIçµ±åˆ

- [ ] OpenAI GPT-4çµ±åˆ
- [ ] ãƒãƒ©ãƒ³ã‚¹åˆ†æã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- [ ] ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºãƒ‰ææ¡ˆ

### Phase 5: Admin UI

- [ ] ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç®¡ç†ç”»é¢
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³è»¸è¨­å®šç”»é¢
- [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ã‚µãƒãƒ¼ãƒˆ

è³ªå•ã‚„å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ã€GitHubã®Issuesã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚
